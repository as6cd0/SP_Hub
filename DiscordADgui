local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local player = Players.LocalPlayer
local API_URL = "http://217.154.114.227:11336/check_whitelist"


local SpecialPlayers = {
    [""] = true,
    [""] = true
}

local function notify(title, text, duration)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = duration;
    })
end

notify("Checking", "Wait for checking if you are registerd or not...", 2)

local function httpGet(url)
    if HttpService.HttpEnabled then
        local ok, res = pcall(function()
            return HttpService:GetAsync(url, false)
        end)
        if ok and res then
            return true, res
        end
    end
    
    local requestFunctions = {
        http_request,
        request,
        (syn and syn.request),
        (http and http.request),
        (fluxus and fluxus.request)
    }
    
    for _, reqFunc in ipairs(requestFunctions) do
        if reqFunc then
            local ok, res = pcall(function()
                return reqFunc({Url = url, Method = "GET"})
            end)
            
            if ok and res then
                if type(res) == "table" and res.Body then
                    return true, res.Body
                elseif type(res) == "string" then
                    return true, res
                end
            end
        end
    end
    
    return false, nil
end

local function isWhitelisted()
    local username = player and player.Name or ""
    if username == "" then
        return "offline", false
    end

    local url = API_URL .. "?username=" .. HttpService:UrlEncode(username)
    local ok, body = httpGet(url)

    if not ok or not body then
        return "offline", false
    end

    local decoded
    local success = pcall(function()
        decoded = HttpService:JSONDecode(body)
    end)

    if not success or type(decoded) ~= "table" then
        return "offline", false
    end

    return "ok", decoded.whitelisted == true
end

local status, whitelisted = isWhitelisted()

if status == "ok" and whitelisted then
    notify("✅ Registered", "You are already registered enjoy", 2)
    return
elseif status == "offline" then
    notify("⚠️ Server Offline", "Server is currently offline, Sorry for that but if the server is offline he will not work properly so it will showyou the AD", 3)
else
    notify("❌ Not Registered", "You are not registered. Go to the Discord server and register to remove the ad", 4)
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DiscordAdUI"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.AnchorPoint = Vector2.new(0.5, 0.5)
Frame.Position = UDim2.new(0.5, 0, 0.5, 0)
Frame.Size = UDim2.new(0, 600, 0, 400)
Frame.BackgroundColor3 = Color3.new(0, 0, 0)
Frame.Active = true

local UICorner = Instance.new("UICorner")
UICorner.Parent = Frame
UICorner.CornerRadius = UDim.new(0, 9)

local Label2 = Instance.new("TextLabel")
Label2.Parent = Frame
Label2.BackgroundTransparency = 1
Label2.Position = UDim2.new(0.05, 0, 0.03, 0)
Label2.Size = UDim2.new(0, 50, 0, 50)
Label2.Text = "AD"
Label2.TextColor3 = Color3.new(1, 1, 1)
Label2.TextScaled = true
Label2.Font = Enum.Font.SourceSans

local Label1 = Instance.new("TextLabel")
Label1.Parent = Frame
Label1.BackgroundTransparency = 1
Label1.Position = UDim2.new(0.2, 0, 0.05, 0)
Label1.Size = UDim2.new(0, 400, 0, 50)
Label1.Text = "Join our new server Discord for more updates!"
Label1.TextColor3 = Color3.new(1, 1, 1)
Label1.TextScaled = true
Label1.Font = Enum.Font.SourceSans

local SecondsLabel = Instance.new("TextLabel")
SecondsLabel.Parent = Frame
SecondsLabel.BackgroundTransparency = 1
SecondsLabel.Position = UDim2.new(0.4, 0, 0.2, 0)
SecondsLabel.Size = UDim2.new(0, 100, 0, 50)
SecondsLabel.Text = "15"
SecondsLabel.TextColor3 = Color3.new(1, 1, 1)
SecondsLabel.TextScaled = true
SecondsLabel.Font = Enum.Font.SourceSans

local Label5 = Instance.new("TextLabel")
Label5.Parent = Frame
Label5.BackgroundTransparency = 1
Label5.Position = UDim2.new(0.17, 0, 0.58, 0)
Label5.Size = UDim2.new(0, 400, 0, 50)
Label5.Text = "Wanna stop this ad? just join the server"
Label5.TextColor3 = Color3.new(1, 1, 1)
Label5.TextScaled = true
Label5.Font = Enum.Font.SourceSans

local Button = Instance.new("TextButton")
Button.Parent = Frame
Button.Position = UDim2.new(0.32, 0, 0.8, 0)
Button.Size = UDim2.new(0, 200, 0, 50)
Button.Text = "Click To Copy Link"
Button.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
Button.TextScaled = true
Button.Font = Enum.Font.SourceSans
Button.TextColor3 = Color3.new(1, 1, 1)

local UICorner2 = Instance.new("UICorner")
UICorner2.Parent = Button
UICorner2.CornerRadius = UDim.new(0, 6)

Button.MouseButton1Click:Connect(function()
    pcall(function()
        setclipboard("https://discord.gg/hrMtDwFvEG")
    end)
    Button.Text = "Link copied"
end)

ScreenGui.Parent = game.CoreGui

spawn(function()
    for i = 15, 0, -1 do
        SecondsLabel.Text = tostring(i)
        wait(1)
    end
    ScreenGui:Destroy()
end)

if player and (player.Name == "nadermohamedtest" or player.Name == "nadermohamed6") then
    local CloseButton = Instance.new("TextButton")
    CloseButton.Parent = Frame
    CloseButton.Position = UDim2.new(0.4, 0, 0.40, 0)
    CloseButton.Size = UDim2.new(0, 100, 0, 40)
    CloseButton.Text = "Close"
    CloseButton.BackgroundColor3 = Color3.new(1, 0, 0)
    CloseButton.TextScaled = true
    CloseButton.Font = Enum.Font.SourceSans
    CloseButton.TextColor3 = Color3.new(1, 1, 1)

    local UICorner3 = Instance.new("UICorner")
    UICorner3.Parent = CloseButton
    UICorner3.CornerRadius = UDim.new(0, 6)

    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)
end
